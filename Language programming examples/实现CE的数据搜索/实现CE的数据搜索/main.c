//
//  main.c
//  实现CE的数据搜索
//
//  Created by 陆敏 on 2019/2/4.
//  Copyright © 2019 陆敏. All rights reserved.
//
/*
 模拟实现CE的数据搜索功能:
 这堆数据存储了角色的名字信息（WOW），列出角色名的内存地址。
 0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x06,0x09,
 0x00,0x20,0x10,0x03,0x03,0x0C,0x00,0x00,0x44,0x00,
 0x00,0x33,0x00,0x47,0x0C,0x0E,0x00,0x0D,0x00,0x11,
 0x00,0x00,0x00,0x02,0x64,0x00,0x00,0x00,0xAA,0x00,
 0x00,0x00,0x64,0x10,0x00,0x00,0x00,0x00,0x00,0x00,
 0x00,0x00,0x02,0x00,0x74,0x0F,0x41,0x00,0x00,0x00,
 0x01,0x00,0x00,0x00,0x05,0x00,0x00,0x00,0x0A,0x00,
 0x00,0x02,0x57,0x4F,0x57,0x00,0x06,0x08,0x00,0x00,
 0x00,0x00,0x00,0x64,0x00,0x0F,0x00,0x00,0x0D,0x00,
 0x00,0x00,0x23,0x00,0x64,0x00,0x00,0x00,0x64,0x00
 1.编写返回角色名字信息地址，如果没有返回0
 char* FindRoleNameAddr(char* pData, char* pRoleName)
 2.编写函数，遍历上面数据中所有角色名字。
 */
#include <stdio.h>
#include <string.h>
//求字符串长度
int StrLen(char* str){
    int ret = 0;
    while (*str != 0) {
        ret++;
        str++;
    }
    return ret;
}
//字符串拷贝
char* StrCpy(char* dest,char* src){
    char* ret = dest;
    while (((*dest++) = (*src++)));
    return ret;
}
//字符串拼接
char* StrCat(char* dest,char* src){
    char* ret = dest;
    while (*dest != 0) {
        dest++;
    }
    while ((*dest++ = *src++));
//    while (*src != 0) {
//        *dest++ = *src++;
//    }
    return ret;
}
//编写字符串比较函数
int StrCmp(char* dest, char* src){
    
    if (StrLen(dest)>=StrLen(src)) {
        while (*dest != 0){
            if (*dest != *src) {
                return *dest-*src;
            }
            dest++;
            src++;
        };
    }else {
        while (*src != 0){
            if (*src != *dest) {
                return -*src+*dest;
            }
            dest++;
            src++;
        };
    }
    return 0;
}
//编写返回角色名字信息地址，如果没有返回0
char* FindRoleNameAddr(char* pData, char* pRoleName){
    printf("%d\n",StrLen(pRoleName));
    for (int i=0; i<100; i++) {
        
        if (StrLen(pRoleName)>2) {
            int* p = (int*)pData+i;
            for (int j=0; j<25-i/4; j++) {
                if (StrCmp(pRoleName, p+j) == 0) {
                    printf("%d %s %p %s %p\n",StrCmp(pRoleName, p+j),pRoleName,*pRoleName,p+j,*(p+j));
                    printf("%s %p\n",p+j,*(p+j));
                    return *(p+j);
                }
            }
        }else{
            short* p = pData+i;
            for (int j=0; j<50-i/2; j++) {
                if (StrCmp(pRoleName, p+j) == 0) {
                    printf("%d %s %p %s %p\n",StrCmp(pRoleName, p+j),pRoleName,*pRoleName,p+j,*(p+j));
                    printf("%s %p\n",p+j,*(p+j));
                    return *(p+j);
                }
            }
        }
        
    }
    return 0;
}
char str[] = "WOW";
char data[100] = {
    0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x06,0x09,
    0x00,0x20,0x10,0x03,0x03,0x0C,0x00,0x00,0x44,0x00,
    0x00,0x33,0x00,0x47,0x0C,0x0E,0x00,0x0D,0x00,0x11,
    0x00,0x00,0x00,0x02,0x64,0x00,0x00,0x00,0xAA,0x00,
    0x00,0x00,0x64,0x10,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x02,0x00,0x74,0x0F,0x41,0x00,0x00,0x00,
    0x01,0x00,0x00,0x00,0x05,0x00,0x00,0x00,0x0A,0x00,
    0x00,0x02,0x57,0x4F,0x57,0x00,0x06,0x08,0x00,0x00,
    0x00,0x00,0x00,0x64,0x00,0x0F,0x00,0x00,0x0D,0x00,
    0x00,0x00,0x23,0x00,0x64,0x00,0x00,0x00,0x64,0x00}
;
void FindBloodAddr() {
    printf("%p %s\n",*str,str);
    char* p;
    p = data;
    short* p1;
    p1 = (short*)data;
    int* p2;
    p2 = (int*)data;
    for (int i=0; i<100; i++) {
        printf("%p\t%p %s\t\t%p\t%p\t\t%p %s\t%p\n",p+i,*(p+i),(p+i),p1+i/2,*(p1+i/2),p2+i/4,p2+i/4,*(p2+i/4));
    }
}
int main(int argc, const char * argv[]) {
    
    //FindBloodAddr();
    printf("%p\n",FindRoleNameAddr(data, str));
    
    // insert code here...
    printf("Hello, World!\n");
    return 0;
}
